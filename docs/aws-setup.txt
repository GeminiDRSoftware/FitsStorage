# ssh connection that tunnels svn with it
# From inside gemini:
ssh -R 8080:scisoft:80 arcdev


# Setup from scratch:
Lauch Instance
AWS Marketplace -> search for centos
CentOS 7 (x86_64) with updates HVM # don't select a specific version eg 6.4 - just get generic latest
m4.2xlarge
configure details
subnet for 2a
protect against termination
add storage
root to 8 GB General purpose SSD
250GB IO1 with 500 IOPS
tag instance
config security group
select existing secuirty group and select it
review and launch
launch
label it as archive in instance list

ssh -i arcdev.pem centos@ip-address
# Check root partition is full size
yum update  # This will take a while
shutdown -r now  # to pick up new kernel etc from update
ssh back in
useradd -u 5151 phirst
useradd -u 5179 fitsdata
passwd phirst
passwd fitsdata
sudo vi /etc/ssh/sshd_config
# RSAAuthentication yes
# PubkeyAuthentication yes
# PasswordAuthentication yes
# TCPKeepAlive yes

systemctl restart sshd
vi /etc/group 
# add phirst user to wheel group at least
vi /etc/selinux/config
# SELINUX=permissive

yum install -y lvm2 mdadm ntp tcsh wget sysstat psmisc dump subversion
vi /etc/ntp.conf
server x.amazon.pool.ntp.org iburst   (for all servers)
systemctl start ntpd
systemctl enable ntpd
ntpstat  # to check status
vi /etc/sysconfig/network
HOSTNAME=arcdev.gemini.edu
vi /etc/hostname
arcdev.gemini.edu
vi /etc/cloud/cloud.cfg append to end of file:
preserve_hostname: true

# LVM layer
pvcreate /dev/xvdb
vgcreate data /dev/xvdb
lvcreate --size=240GB -n data data
mke2fs -t ext4 -L data /dev/data/data

vi /etc/fstab
mount /data

# SELINUX permissive
vi /etc/selinux/config 
SELINUX=permissive

# Firewall
yum install system-config-firewall
# might need to reboot
system-config-firewall 
# disable it



# postfix for email
yum install postfix
vi /etc/postfix/main.cf
set hostname to arcdev.gemini.edu
AWS webform to request reverse DNS entry for elastic IP and EIP whitelisting

