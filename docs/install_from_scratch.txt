clean RHEL6 machine standard ISG install. 

- Have ISG set up a user account for you with sudo all.
- sort out path etc in account so that which python gives you the /astro one

- log in and change your password.

sudo yum -y install httpd
sudo yum -y install httpd-devel
sudo chmod oug+rx /var/log/httpd
sudo yum -y install postgresql 
sudo yum -y install postgresql-server
sudo yum -y install postgresql-devel

# might not need with Ureka
# needed to get mod_python to build as /astro python links against X11
sudo yum -y install libX11-devel

# needed with Ureka if not already present:
sudo yum -y install libXft

# On RHEL6 also need these if they're not already there:
sudo yum -y install libtool
# Not sure if we really need these:
sudo yum -y install tk
sudo yum -y install tk-devel

# Need these if you're going to run 32bit java from /astro
sudo yum install glibc-devel.i686
sudo yum install libstdc++-devel.i686
sudo yum install compat-glibc

sudo /usr/sbin/groupadd -g 5179 fitsdata
sudo /usr/sbin/useradd -c 'FITS data' -u 5179 -g 5179 fitsdata
sudo passwd fitsdata

sudo mkdir /opt/FitsStorage
sudo chown fitsdata:fitsdata /opt/FitsStorage/

sudo mkdir /opt/python_modules
sudo chown phirst /opt/python_modules

* LOG in as fitsdata and do:
cd /opt/FitsStorage
svn checkout http://scisoft/svn/FitsStorage/trunk .

gcc invoke.c -o invoke
chmod oug+x invoke
chmod ug+s invoke

* Log out and back in as yourself (phirst)

sudo mkdir /opt/Ureka
sudo chown phirst /opt/Ureka
cd /opt/Ureka
cp /opt/FitsStorage/otherfiles/install_ureka_1.4.1 .
sh install_ureka_1.4.1
#Remove broken ureka pkg-config
mv /opt/Ureka/Ureka/python/bin/pkg-config /opt/Ureka/Ureka/python/bin/pkg-config-broken


cd /opt/python_modules
tar xvzf /opt/FitsStorage/otherfiles/mod_python-3.3.1-1.tar.gz
cd mod_python-3.3.1
which python # should be on /astro
whereis apxs # probably /usr/sbin/apxs
./configure --with-apxs=/usr/sbin/apxs --prefix=/opt/python_modules
make
sudo make install_dso
cd dist
python setup.py install --prefix=/opt/python_modules

cd /opt/python_modules
tar xvzf /opt/FitsStorage/otherfiles/psycopg2-2.5.2.tar.gz
cd psycopg2-2.5.2
which pg_config
# should be /usr/bin/pg_config - else:
# vi setup.cfg 
# set pg_config=/usr/bin/pg_config
python setup.py build
python setup.py install --prefix=/opt/python_modules
cd /opt/python_modules
tar xvzf /opt/FitsStorage/otherfiles/SQLAlchemy-0.9.3.tar.gz
cd SQLAlchemy-0.9.3
setenv PYTHONPATH /opt/python_modules/lib/python2.7/site-packages
python setup.py build
python setup.py install --prefix=/opt/python_modules
cd ..
# Make sure using /astro python, and have DPD pythonpath
# add /opt/sqlalchemy to python path

cd /opt/python_modules
tar xvf /opt/FitsStorage/otherfiles/pyinotify-0.8.8.tar.gz
cd pyinotify
python setup.py build
python setup.py install --prefix=/opt/python_modules

# if using s3
cd /opt/python_modules
tar xvf /opt/FitsStorage/otherfiles/boto-2.23.0.tar.gz
cd boto-2.23.0
python setup.py build
python setup.py install --prefix=/opt/python_modules


sudo mkdir /opt/fitsverify
sudo chown phirst /opt/fitsverify
cd /opt/fitsverify
tar xvf /opt/FitsStorage/otherfiles/fitsverify.tar
mv fitsverify/* .
rmdir fitsverify
gcc -o fitsverify ftverify.c fvrf_data.c fvrf_file.c fvrf_head.c fvrf_key.c fvrf_misc.c -DSTANDALONE -L/opt/Ureka/Ureka/python/lib -I/opt/Ureka/Ureka/python/include -lcfitsio -lm -lnsl

sudo mkdir /opt/gemini_python
sudo chown phirst /opt/gemini_python
cd /opt/gemini_python
svn checkout http://chara.hi.gemini.edu/svn/DRSoftware/gemini_python/trunk .

cd
sudo cp /opt/FitsStorage/otherfiles/etc-httpd-conf.d-python.conf /etc/httpd/conf.d/python
sudo cp /opt/FitsStorage/otherfiles/etc-httpd-conf-httpd.conf /etc/httpd/conf/httpd.conf 
sudo cp /opt/FitsStorage/otherfiles/etc-sysconfig-httpd /etc/sysconfig/httpd
sudo mkdir /var/www/python-egg-cache
sudo chmod oug+rwx /var/www/python-egg-cache

sudo mkdir /opt/cadc
sudo chown phirst /opt/cadc
cd /opt/cadc
# install cadc stuff
tar xvf /opt/FitsStorage/otherfiles/mdIngest.tar
sudo mkdir /opt/jars
sudo chown phirst /opt/jars
cd /opt/jars
tar xvf /opt/FitsStorage/otherfiles/jars.tar

# Set up postgres
sudo mkdir /data/pgsql_data
sudo chown postgres:postgres /data/pgsql_data
sudo vi /etc/sysconfig/pgsql/postgresql
PGDATA=/data/pgsql_data
sudo service postgresql initdb
sudo /etc/init.d/postgresql start 
sudo su - postgres
/usr/bin/createuser --no-superuser --no-createrole --createdb fitsdata
/usr/bin/createuser --no-superuser --no-createrole --no-createdb apache
vi /data/pgsql_data/postgresql.conf
#shared_buffers = 256MB
# 25% of memory if memory > 1GB
#
# If there will be remote access to this database (eg for eavedropping)
# set listen_addresses = '*' in postgresql.conf, also:
vi /data/pgsql_data/pg_hba.conf
# At end of file, add a comment line to say what you're adding, then
# eg: host    fitsdata    all         10.1.5.47/32          trust

exit
sudo /etc/init.d/postgresql restart

# Need to set postgresql and httpd to start at boot
sudo /etc/init.d/httpd start
sudo /sbin/chkconfig httpd on
sudo /sbin/chkconfig postgresql on


# Log and backup directories
sudo mkdir /data/logs
sudo chown fitsdata /data/logs
sudo mkdir /data/backups
sudo chown fitsdata /data/backups
sudo mkdir /data/upload_staging
sudo chown fitsdata /data/upload_staging
sudo chmod oug+rwx /data/upload_staging
sudo mkdir /data/z_staging
sudo chown fitsdata /data/z_staging
# if using s3
sudo mkdir /data/s3_staging
sudo chown fitsdata /data/s3_staging

# Now get a shell as fitsdata
cd /opt/FitsStorage/
vi FitsStorageConfig # Set things up as appropriate
/usr/bin/createdb fitsdata
python create_tables.py

# OK, should now be good to go.
