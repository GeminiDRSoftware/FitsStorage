clean centos 7 machine standard ISG install. 

- Have ISG set up a user account for you with sudo all.

sudo yum -y install httpd httpd-devel mod_ssl openssl
sudo chmod oug+rx /var/log/httpd
sudo yum -y install postgresql postgresql-server postgresql-devel

# On AWS centos machines need to install EPEL repository (included by default on ISG config)
sudo yum install -y epel-release

# Also need:
sudo yum -y install gcc gcc-c++ python-pip python-devel libpng-devel blas lapack openblas openblas-devel gcc-gfortran cfitsio-devel freetype-devel

sudo pip install --upgrade pip
sudo pip install psycopg2
sudo pip install sqlalchemy
sudo pip install pyyaml
sudo pip install jinja2
sudo pip install pyfits
sudo pip install pywcs
sudo pip install dateutils
sudo pip install matplotlib
sudo pip install scipy
sudo pip install pandas
sudo pip install astropy

sudo /usr/sbin/groupadd -g 5179 fitsdata
sudo /usr/sbin/useradd -c 'FITS data' -u 5179 -g 5179 fitsdata
sudo passwd fitsdata

# If this is a gemini fits server
sudo vi /etc/group
geminidata:x:502:fitsdata

sudo mkdir /opt/FitsStorage
sudo chown fitsdata:fitsdata /opt/FitsStorage/

sudo mkdir /opt/python_modules
sudo chown phirst /opt/python_modules

* LOG in as fitsdata and do:
cd /opt/FitsStorage
svn checkout http://scisoft/svn/FitsStorage/trunk .

* Log out and back in as yourself (phirst)

cd /opt/python_modules
tar xvzf /opt/FitsStorage/otherfiles/mod_python-3.3.1-2.tar.gz
cd mod_python-3.3.1
./configure --with-apxs=/usr/bin/apxs --prefix=/opt/python_modules
make
sudo make install_dso
cd dist
python setup.py install --prefix=/opt/python_modules

# if using s3
sudo pip install boto3

sudo mkdir /opt/fitsverify
sudo chown phirst /opt/fitsverify
cd /opt/fitsverify
tar xvf /opt/FitsStorage/otherfiles/fitsverify.tar
mv fitsverify/* .
rmdir fitsverify
gcc -o fitsverify ftverify.c fvrf_data.c fvrf_file.c fvrf_head.c fvrf_key.c fvrf_misc.c -DSTANDALONE -I/usr/include/cfitsio -lcfitsio -lm -lnsl

sudo mkdir /opt/gemini_python
sudo chown phirst /opt/gemini_python
cd /opt/gemini_python
svn checkout http://chara.hi.gemini.edu/svn/DRSoftware/gemini_python/trunk .

cd
sudo cp /opt/FitsStorage/otherfiles/etc-httpd-conf.d-zz-archive.conf /etc/httpd/conf.d/zz-archive.conf
sudo cp /opt/FitsStorage/otherfiles/etc-httpd-conf.modules.d-10-python.conf /etc/httpd/conf.modules.d/10-python.conf
sudo cp /opt/FitsStorage/otherfiles/etc-httpd-conf-httpd.conf /etc/httpd/conf/httpd.conf 
sudo cp /opt/FitsStorage/otherfiles/etc-sysconfig-httpd /etc/sysconfig/httpd
sudo mkdir /var/www/python-egg-cache
sudo chmod oug+rwx /var/www/python-egg-cache

# Set up postgres
sudo mkdir /data/pgsql_data
sudo chown postgres:postgres /data/pgsql_data
sudo cp /lib/systemd/system/postgresql.service /etc/systemd/system/
sudo vi /etc/systemd/system/postgresql.service
Enviroment=PGDATA=/data/pgsql_data
sudo systemctl daemon-reload
sudo postgresql-setup initdb
sudo systemctl start postgresql.service
sudo su - postgres
/usr/bin/createuser --no-superuser --no-createrole --createdb fitsdata
/usr/bin/createuser --no-superuser --no-createrole --no-createdb apache
vi /data/pgsql_data/postgresql.conf
#shared_buffers = 256MB
# 25% of memory if memory > 1GB

effective_cache_size = 8000MB

#
# If there will be remote access to this database (eg for eavedropping)
# set listen_addresses = '*' in postgresql.conf, also:
vi /data/pgsql_data/pg_hba.conf
# At end of file, add a comment line to say what you're adding, then
# eg: host    fitsdata    all         10.1.5.47/32          trust

exit
sudo systemctl restart postgresql.service


# Need to set postgresql and httpd to start at boot
sudo systemctl enable postgresql.service
sudo systemctl enable httpd.service


# Log and backup directories
sudo mkdir /data/logs
sudo chown fitsdata /data/logs
sudo mkdir /data/backups
sudo chown fitsdata /data/backups
sudo mkdir /data/upload_staging
sudo chown fitsdata /data/upload_staging
sudo chmod oug+rwx /data/upload_staging
sudo mkdir /data/z_staging
sudo chown fitsdata /data/z_staging
# if using s3
sudo mkdir /data/s3_staging
sudo chown fitsdata /data/s3_staging
# apache needs access to this to download preview images now
sudo chmod oug+rw /data/s3_staging


# Now get a shell as fitsdata
cd /opt/FitsStorage/fits_storage
vi fits_storage_config.py
# Set things up as appropriate
/usr/bin/createdb fitsdata
python scripts/create_tables.py

# OK, should now be good to go.

# Check with ISG if you need a whitelisted local mail relay on it
# Check with ISG that the development / operations status of the machine


# To run jobs from systemd
sudo cp /opt/FitsStorage/otherfiles/etc_systemd_system_fits-service_ingest_queue1.service /etc/systemd/system/fits-service_ingest_queue1.service
# copy again and edit for siq2 if you want two of them
sudo systemctl start fits-service_ingest_queue1
sudo systemctl enable fits-service_ingest_queue1
# Same for 2 if you want it
# Repeat for export queue and api
