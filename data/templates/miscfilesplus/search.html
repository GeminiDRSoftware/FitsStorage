{% extends "miscfilesplus/miscfilesplus_layout.html" %}

{% block title %}MiscFiles Plus Search{% endblock %}

{% block navbar %}
<nav class="navbar navbar-default navbar-light bg-light navbar-expand-lg">
    <ul class="nav navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/miscfilesplus/">Top</a>
        </li>
        <li class="nav-item">
            <form class="navbar-form navbar-left form-inline" action="/miscfilesplus/search" method="get"
                  enctype="multipart/form-data">
                <input type="text" class="form-control" name="search_field"
                    id="search_field" placeholder="Search..." value="{{ search_field }}"/>
                <button type="submit" class="btn btn-success form-control" id="search_button">Search</button>
            </form>
        </li>
    </ul>
</nav>
{% endblock %}

{% block miscfiles_body %}
<div class="container-fluid">
    <div class="row">
        <div role="main" class="col-lg-12">
            {% if not collections and not folders and not files %}
            <br/>
            <div class="card">
                <div class="card-header">No Results</div>
                <div class="card-body">
                    No results found for search.
                </div>
            </div>
            {% endif %}
            {% if collections %}
            <br/>
            <div class="card">
                <div class="card-header">Collections</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped  table-sm">
                            <tr><th>Name</th><th>Program ID</th><th>Description</th></tr>
                        {% for collection in collections %}
                            <tr><td><a href="browse/{{ collection.name }}/">{{ collection.name }}</a></td>
                            <td>{{ collection.program_id }}</td>
                            <td>{{ collection.description | truncate(1024) }}</td></tr>
                        {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if folders or files %}
            <br/>
            <form action="/miscfilesplus/downloadzip" method="post" target="_blank">
            <div class="card">
                <div class="card-header">Files</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <tr><th></th><th>Collection</th>
                                <th>Path
                                </th>
                                <th>Filename
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=name"><span class="fa fa-arrow-up"></span></a>
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=-name"><span class="fa fa-arrow-down"></span></a></th>
                                <th>Size
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=size"><span class="fa fa-arrow-up"></span></a>
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=-size"><span class="fa fa-arrow-down"></span></a></th>
                                </th>
                                <th>Last Modified
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=last_modified"><span class="fa fa-arrow-up"/></a>
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=-last_modified"><span class="fa fa-arrow-down"/></a></th>
                                </th>
                                <th>Program ID
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=program_id"><span class="fa fa-arrow-up"></span></a>
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=-program_id"><span class="fa fa-arrow-down"></span></a></th>
                                </th>
                                <th>Release Date
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=release_date"><span class="fa fa-arrow-up"></span></a>
                                <a href="/miscfilesplus/search?search_field={{ search_field }}&order_by=-release_date"><span class="fa fa-arrow-down"></span></a></th>
                                </th>
                            <th>Action</th></tr>
                        {% if folders %}
                            {% for folder in folders %}
                            <tr><td></td><td>{{ folder.collection.name }}</td><td>{{ folder.parentpath() }}</td><td><span class="fa fa-folder-open">&nbsp;&nbsp;</span><a href="/miscfilesplus/browse/{{ folder.collection.name }}/{{ folder.path() }}/">{{ folder.name }}</a></td><td></td><td></td><td></td><td></td>
                            {% if can_add %}
                                <td></td><td><a href="/miscfilesplus/delete/{{ folder.collection.name }}/{{ folder.path() }}/">&nbsp;&nbsp;<span class="fa fa-trash"></span></a></td></tr>
                            {% else %}
                            <td></td></tr>
                            {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% if files %}
                            {% for file in files %}
                            {% if file.folder %}
                            <tr><td><input type="checkbox" id="files" name="files" value="{{ file.id }}"></td><td>{{ file.collection.name }}</td><td>{{ file.parentpath() }}</td><td><span class="fa fa-file">&nbsp;&nbsp;</span><a href="/miscfilesplus/download/{{ file.collection.name }}/{{ file.folder.path() }}/{{ file.filename | urlencode }}">{{ file.filename }}</a></td>
                            {% else %}
                            <tr><td><input type="checkbox" id="files" name="files" value="{{ file.id }}"></td><td>{{ file.collection.name }}</td><td>{{ file.parentpath() }}</td><td><span class="fa fa-file">&nbsp;&nbsp;</span><a href="/miscfilesplus/download/{{ file.collection.name }}/{{ file.filename | urlencode }}">{{ file.filename }}</a></td>
                            {% endif %}
                            <td>{{ file.size }}</td><td>{{ file.last_modified }}</td><td>{{ file.program_id }}</td><td>{{ file.release.strftime('%Y-%m-%d') }}</td>
                            {% if can_add %}
                              {% if folder %}
                                <td><a href="/miscfilesplus/delete/{{ file.collection.name }}/{{ folder.path() }}/{{ file.filename | urlencode }}">&nbsp;&nbsp;<span class="fa fa-trash"></span></a></td>
                              {% else %}
                                <td><a href="/miscfilesplus/delete/{{ file.collection.name }}/{{ file.filename | urlencode }}">&nbsp;&nbsp;<span class="fa fa-trash"></span></a></td>
                              {% endif %}
                            {% else %}
                            <td></td>
                            {% endif %}
                            </tr>
                            {% endfor %}
                        {% endif %}
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-12 text-center">
            <button type="submit" class="btn btn-success form-control" id="download_button">Download Selected</button>
            </div>
            </form>
            {% endif %}
        <div>
    </div>
</div>
{% endblock %}

{% block miscfiles_dialogs %}
{% endblock %}
