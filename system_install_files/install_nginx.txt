# nginx etc install on rocky 8
FS_SIF=/opt/FitsStorage/system_install_files
#
yum install nginx
#
# pip install uwsgi
conda install uwsgi
#
yum install python3-certbot-nginx
#
mkdir /opt/uwsgi
chown fitsdata:fitsdata /opt/uwsgi
chmod u=rwx,g=rwx,o=rx /opt/uwsgi
#
cp $FS_SIF/etc_systemd_system_fits-uwsgi.service /etc/systemd/system/fits-uwsgi.service
cp $FS_SIF/etc_systemd_system_fits-nginx.service /etc/systemd/system/fits-nginx.service
cp $FS_SIF/uwsgi.ini /opt/uwsgi/fitsservice.ini
cp $FS_SIF/nginx-fits /etc/nginx/nginx.conf #See other nginx-blah files available
#
# (ARCDEV) Setup Let's Encrypt (nginx)
#certbot certonly --nginx -d arcdev.gemini.edu
#systemctl restart fits-nginx
#
# AWS Setup SELinux for UWSGI
#sudo semanage fcontext -a -t httpd_sys_content_rw_t 'fits.sock'
#sudo restorecon -v 'fits.sock'
#
# (ARCHIVE) Setup Let's Encrypt (nginx)
#certbot certonly --nginx -d archive.gemini.edu
#systemctl restart fits-nginx
#
# Build SELinux definitions for nginx to talk to uwsgi socket
#bash -c "cat /opt/FitsStorage/otherfiles/nginx.te | audit2allow -M nginx"
# Load SELinux
#semodule -i nginx.pp